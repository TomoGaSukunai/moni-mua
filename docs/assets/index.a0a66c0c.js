var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,s=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,c=(e,a)=>{for(var l in a||(a={}))n.call(a,l)&&s(e,l,a[l]);if(t)for(var l of t(a))i.call(a,l)&&s(e,l,a[l]);return e};import{D as o,r as u,w as r,d,c as v,o as m,a as k,b as f,t as g,e as p,F as h,f as w,g as b,T as L,h as y,v as S,i as C,j as B,k as x,l as _}from"./vendor.bd3a9aa3.js";!function(e=".",a="__import__"){try{self[a]=new Function("u","return import(u)")}catch(l){const t=new URL(e,location),n=e=>{URL.revokeObjectURL(e.src),e.remove()};self[a]=e=>new Promise(((l,i)=>{const s=new URL(e,t);if(self[a].moduleMap[s])return l(self[a].moduleMap[s]);const c=new Blob([`import * as m from '${s}';`,`${a}.moduleMap['${s}']=m;`],{type:"text/javascript"}),o=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(c),onerror(){i(new Error(`Failed to import: ${e}`)),n(o)},onload(){l(self[a].moduleMap[s]),n(o)}});document.head.appendChild(o)})),self[a].moduleMap={}}}("/assets/");const N=o.create({baseURL:"https://json2jsonp.com"});N.interceptors.response.use((e=>{const a=e.data;return JSON.parse(a.replace(/^_(?:_jsonp)?\((.*)\)$/,"$1"))}));function I(){const e=u([]),a=u(0),l=u(!1),t=u(!1);let n=1,i=[];async function s(l=!1){const{code:c,data:o}=await(async(e=1,a=!1)=>{const l=new Date,t="&"+l.getFullYear()+l.getMonth()+l.getDate()+l.getHours(),n=a?`&_=${Math.floor(Date.now()/1e3)}`:t;return await N.get("",{params:{url:`https://api.live.bilibili.com/guard/topList?roomid=23001181&page_size=29&ruid=1589117610&page=${e}${n}`,callback:"_"}})})(n,l);if(-412===c){const a=await(async()=>(await fetch("https://api.vtbs.moe/v1/guard/1589117610")).json())();return e.value=a.map((({mid:e,level:a,face:l,uname:t})=>({uid:e,face:l,username:t,guard_level:a,is_alive:0}))),t.value=!0,void alert("被拦截了，用缓存数据代替")}if(0!==c)return;t.value=!1;const{info:u,list:r}=o;if(i=1===n?r:[...i,...r],n===u.page)return i=[...o.top3,...i],e.value=[...i.filter((e=>1===e.is_alive)),...i.filter((e=>0===e.is_alive))],void(n=1);a.value=u.num,n++,await s(l)}return{isCache:t,loading:l,guardNum:a,guardList:e,onRefresh:async(a=!0,t=!1)=>{l.value||(t||(l.value=!0,e.value=[]),await s(a),l.value=!1)}}}const M=window.localStorage,R=window.sessionStorage,G={get(e){const a=M.getItem(e);return a?JSON.parse(a):""},set(e,a){M.setItem(e,JSON.stringify(a))},remove(e){M.removeItem(e)}},O={get(e){const a=R.getItem(e);return a?JSON.parse(a):""},set(e,a){R.setItem(e,JSON.stringify(a))},remove(e){R.removeItem(e)}};function j(){const e=u([]);return{rankList:e,getRankList:()=>{e.value=(G.get("moni/rank/mua")||[]).sort(((e,a)=>a.count-e.count))},addRank:t=>{if(!t)return;const n=e.value.findIndex((e=>e.uid===t.uid));var i;-1===n?e.value.push((i=c({},t),a(i,l({count:1})))):e.value[n].count=(e.value[n].count||0)+1,e.value=[...e.value.sort(((e,a)=>a.count-e.count))],G.set("moni/rank/mua",e.value.map((({uid:e,username:a,face:l,count:t,is_alive:n})=>({uid:e,username:a,face:l,count:t,is_alive:n}))))},onClearRank:()=>{e.value=[],G.remove("moni/rank/mua")}}}const W={default:15,max:99,min:1,list:[{weight:8,area:[0,1]},{weight:6,area:[1,3]},{weight:4,area:[3,5]},{weight:2,area:[5,7]},{weight:1,area:[7,Number.MAX_SAFE_INTEGER]}]};function E(e,a,l){const t=u({}),n=u(),i=u(!1),s={};let o={},d=0;(O.get("moni/mua/session/time")||Date.now())-Date.now()>72e5&&(O.remove("moni/mua/session/time"),O.remove("moni/mua/weight")),t.value=O.get("moni/mua/weight")||{},r([e,a,t,l,i],(()=>{e.value.forEach((e=>{const l=a.value.find((a=>a.uid===e.uid));l&&(s[e.uid]=function(e){for(let a=0,l=W.list.length;a<l;a++){const{weight:l,area:t}=W.list[a],[n,i]=t;if(e>n&&e<=i)return l}return W.default}(l.count||0)),s[e.uid]=t.value[e.uid]||s[e.uid]||W.default})),o={};let n=0;e.value.forEach((e=>{if(l.value.includes(e.uid))return;if(i.value&&!e.is_alive)return;const a=s[e.uid];new Array(a).fill(0).forEach((()=>{o[n]=e,n++}))})),d=Object.keys(o).length-1}));return{weightList:t,currentGuard:n,filterNoLive:i,onRandomPick:()=>{const e=Math.floor(Math.random()*d);n.value=o[e]},setWeight:(e,a)=>{(a<W.min||a>W.max)&&(a=W.default),t.value[e]=a,O.set("moni/mua/weight",c({},t.value))},resetWeight:e=>{e?t.value[e]=W.default:t.value={},O.set("moni/mua/weight",c({},t.value))},weightConfig:W}}const $="moni/mua/blackList";var P=d({name:"App",setup(){const{loading:e,guardNum:a,guardList:l,onRefresh:t}=I(),{rankList:n,getRankList:i,addRank:s,onClearRank:c}=j(),{blackList:o,addBlack:r,removeBlack:d,clearBlack:k,hasBlack:f,getBlackList:g}=function(){const e=u([]);e.value=G.get($)||[];const a=a=>e.value.includes(a);return{blackList:e,hasBlack:a,addBlack:a=>{e.value.includes(a)||(e.value.push(a),G.set($,e.value))},removeBlack:a=>{const l=e.value.indexOf(a);-1!==l&&(e.value.splice(l,1),G.set($,e.value))},clearBlack:()=>{e.value=[],G.remove($)},getBlackList:e=>e.value.filter((({uid:e})=>a(e)))}}(),{weightList:p,currentGuard:h,filterNoLive:w,setWeight:b,onRandomPick:L,weightConfig:y}=E(l,n,o),S=u(y.max),C=u(y.min),B=v((()=>g(l))),x=u(!1);async function _(){await t(!0,!0),h.value&&(h.value=l.value.find((e=>{var a;return e.uid===(null==(a=h.value)?void 0:a.uid)}))||h.value),setTimeout((async()=>{await _()}),15e3)}m((async()=>{i(),await t(!1),await _()}));const N=u(!1);let M;const R=u(!1),O=u(),W=u(y.default),P=()=>{R.value=!R.value};return{loading:e,guardNum:a,guardList:l,filterNoLive:w,currentGuard:h,onMua:()=>{e.value||(N.value?(N.value=!1,M&&clearInterval(M),s(h.value)):(N.value=!0,L(),M=setInterval((()=>L()),15)))},rankList:n,onClearRank:c,active:N,weightList:p,WEIGHT_MAX:S,WEIGHT_MIN:C,computedBlackList:B,hasBlack:f,blackList:o,addBlack:r,removeBlack:d,clearBlack:k,showBlack:x,onShowBlack:()=>{x.value=!x.value},showSetting:R,selectGuard:O,selectWeight:W,onSelect:e=>{O.value=e,W.value=p.value[e.uid]||y.default,P()},onShowSetting:P,onWeightInput:()=>{W.value<y.min?W.value=y.min:W.value>y.max&&(W.value=y.max)},onSubmitWeight:()=>{O.value&&b(O.value.uid,W.value),P()}}}});const U={class:"moni"},D={class:"guard-container"},T={class:"flex"},A={class:"guard-title flex-1"},F=f("p",{class:"tips"},"每15秒刷新",-1),H={class:"guard-list no-scrollbar"},J={key:0},X={class:"flex-1"},z=f("h3",{class:"title"},"朝海沫霓Moni Mua~",-1),V={class:"container flex"},Y={key:0,style:{padding:"0 20px",color:"#999"}},q={key:1},K={class:"filter"},Q={class:"rank-title flex align-center"},Z=f("p",{class:"flex-1"},"刀了榜",-1),ee={class:"rank-list no-scrollbar"},ae={class:"flex"},le={class:"setting-container"},te=f("h4",null,"权重设置",-1),ne={class:"flex align-center"},ie=f("span",null,"舰长：",-1),se={key:0,class:"flex-1"},ce={class:"flex align-center"},oe=f("span",null,"权重：",-1),ue={class:"black-list-container"},re=f("h4",null,"黑名单",-1),de={class:"black-list no-scrollbar"},ve={class:"flex-1"};P.render=function(e,a,l,t,n,i){return x(),k(h,null,[f("div",U,[f("div",D,[f("div",T,[f("h3",A," 舰长总数： "+g(e.guardNum),1),F]),f("ul",H,[e.loading?(x(),k("li",J," 获取舰长数据中... ")):p("",!0),(x(!0),k(h,null,w(e.guardList,(a=>y((x(),k("li",{key:a.uid,class:["guard-item",a.is_alive?"alive":""]},[f("img",{class:"guard-face",src:a.face+"@128w_128h",alt:"",onClick:l=>e.onSelect(a)},null,8,["src","onClick"]),f("p",{class:["flex-1",{"is-black":e.hasBlack(a.uid)}],onClick:l=>e.onSelect(a)},[f("span",null,g(a.is_alive?"[在线]":""),1),b(" "+g(a.username),1)],10,["onClick"]),f("span",{class:"btn-to-black",onClick:l=>e.addBlack(a.uid)},"[黑]",8,["onClick"])],2)),[[S,!e.filterNoLive||a.is_alive]]))),128))])]),f("div",X,[f("span",{class:"btn-black",onClick:a[1]||(a[1]=(...a)=>e.onShowBlack&&e.onShowBlack(...a))},"黑名单"),z,f("div",V,[e.currentGuard?p("",!0):(x(),k("p",Y," 点击按钮开始抽取，再次点击停止，最终显示的则为今晚的幸运儿。 ")),e.currentGuard?(x(),k(h,{key:1},[e.currentGuard.face?(x(),k("img",{key:0,class:"guard-face",src:e.currentGuard.face+"@128w_128h",alt:""},null,8,["src"])):p("",!0),e.currentGuard&&e.currentGuard.uid?(x(),k("p",q,[f("span",null,g(e.currentGuard.is_alive?"[在线]":"[不在]"),1),b(" "+g(e.currentGuard.username),1)])):p("",!0)],64)):p("",!0)]),f("div",null,[f("p",K,[f("input",{type:"checkbox",checked:e.filterNoLive,onClick:a[2]||(a[2]=a=>e.filterNoLive=!e.filterNoLive)},null,8,["checked"]),f("span",{onClick:a[3]||(a[3]=a=>e.filterNoLive=!e.filterNoLive)}," 过滤不在线舰长 ")]),f("button",{class:"btn-mua",onClick:a[4]||(a[4]=(...a)=>e.onMua&&e.onMua(...a))},g(e.active?"就Mua你了！":"Mua谁呢？"),1)]),f("h3",Q,[Z,f("span",{class:"btn-clear",onClick:a[5]||(a[5]=(...a)=>e.onClearRank&&e.onClearRank(...a))},"清空")]),f("ul",ee,[(x(!0),k(h,null,w(e.rankList,(a=>(x(),k("li",{key:a.uid,class:"flex"},[f("img",{class:"guard-face",src:a.face+"@128w_128h",alt:"",onClick:l=>e.onSelect(a)},null,8,["src","onClick"]),f("p",ae,[f("span",{class:["flex-1",{"is-black":e.hasBlack(a.uid)}],onClick:l=>e.onSelect(a)},g(a.username),11,["onClick"]),f("span",null,g(a.count)+" 次",1)]),f("span",{class:"btn-to-black",onClick:l=>e.addBlack(a.uid)},"[黑]",8,["onClick"])])))),128))])])]),(x(),k(L,{to:"body"},[y(f("div",{class:"mark",onClick:a[10]||(a[10]=B(((...a)=>e.onShowSetting&&e.onShowSetting(...a)),["self"]))},[f("div",le,[f("span",{class:"close",onClick:a[6]||(a[6]=(...a)=>e.onShowSetting&&e.onShowSetting(...a))},"x"),te,f("div",ne,[ie,e.selectGuard?(x(),k("span",se,g(e.selectGuard.username),1)):p("",!0)]),f("div",ce,[oe,y(f("input",{class:"flex-1",type:"number",min:e.WEIGHT_MIN,max:e.WEIGHT_MAX,placeholder:"15","onUpdate:modelValue":a[7]||(a[7]=a=>e.selectWeight=a),onInput:a[8]||(a[8]=(...a)=>e.onWeightInput&&e.onWeightInput(...a))},null,40,["min","max"]),[[C,e.selectWeight]])]),f("div",null,[f("button",{class:"btn-submit",onClick:a[9]||(a[9]=(...a)=>e.onSubmitWeight&&e.onSubmitWeight(...a))},"确认")])])],512),[[S,e.showSetting]])])),(x(),k(L,{to:"body"},[y(f("div",{class:"mark",onClick:a[13]||(a[13]=B(((...a)=>e.onShowBlack&&e.onShowBlack(...a)),["self"]))},[f("div",ue,[f("span",{class:"close",onClick:a[11]||(a[11]=(...a)=>e.onShowBlack&&e.onShowBlack(...a))},"x"),re,f("span",{class:"btn-clear",onClick:a[12]||(a[12]=(...a)=>e.clearBlack&&e.clearBlack(...a))},"清空"),f("ul",de,[(x(!0),k(h,null,w(e.computedBlackList,(a=>(x(),k("li",{key:a.uid,class:"black-item flex align-center"},[f("p",ve,g(a.username),1),f("span",{onClick:l=>e.removeBlack(a.uid)},"删除",8,["onClick"])])))),128))])])],512),[[S,e.showBlack]])]))],64)},_(P).mount("#app");
