var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,l=(a,t,r)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r;import{D as u,r as o,d as c,o as i,c as d,a as m,t as p,b as v,F as f,e as g,f as b,g as y,h}from"./vendor.cc48ec22.js";!function(e=".",a="__import__"){try{self[a]=new Function("u","return import(u)")}catch(t){const r=new URL(e,location),n=e=>{URL.revokeObjectURL(e.src),e.remove()};self[a]=e=>new Promise(((t,s)=>{const l=new URL(e,r);if(self[a].moduleMap[l])return t(self[a].moduleMap[l]);const u=new Blob([`import * as m from '${l}';`,`${a}.moduleMap['${l}']=m;`],{type:"text/javascript"}),o=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(u),onerror(){s(new Error(`Failed to import: ${e}`)),n(o)},onload(){t(self[a].moduleMap[l]),n(o)}});document.head.appendChild(o)})),self[a].moduleMap={}}}("/moni-mua/assets/");const w=u.create({baseURL:"https://json2jsonp.com"});w.interceptors.response.use((e=>{const a=e.data;return JSON.parse(a.replace(/^_(?:_jsonp)?\((.*)\)$/,"$1"))}));function _(){const e=o([]),a=o(0);let t=1,r=[];return{guardNum:a,guardList:e,getGuardList:async function n(s=!1){const{code:l,data:u}=await(async(e=1,a=!1)=>{const t=a?`&t=${Date.now()}`:"";return await w.get("",{params:{url:`https://api.live.bilibili.com/guard/topList?roomid=23001181&ruid=1589117610&page=${e}${t}`,callback:"_"}})})(t,s);if(0!==l)return;const{info:o,list:c}=u;if(t===o.page)return e.value=[...r.filter((e=>1===e.is_alive)),...r.filter((e=>0===e.is_alive))],void(t=1);r=[...r,...c],a.value=o.num,t++,await n(s)},getRandomGuard:function(){const a=Math.floor(Math.random()*(e.value.length-1));return e.value[a]}}}const L=window.localStorage,k={get(e){try{const a=L.getItem(e);return a?JSON.parse(a):""}catch{return""}},set(e,a){L.setItem(e,JSON.stringify(a))}};var O=c({name:"App",setup(){const{guardNum:e,guardList:u,getGuardList:c,getRandomGuard:d}=_(),m=o(!1),p=async(e=!0)=>{m.value||(m.value=!0,u.value=[],await c(e),m.value=!1)};i((async()=>{await p(!1)}));const v=o({}),f=o(!1),g=o([]);let b;g.value=k.get("moni/rank/mua")||[];return{loading:m,guardNum:e,guardList:u,onRefresh:p,currentGuard:v,onMua:()=>{var e;if(!m.value)if(f.value)f.value=!1,b&&clearInterval(b);else{f.value=!0,v.value=d();const u=g.value.findIndex((e=>e.uid===v.value.uid));-1===u?g.value.push((e=((e,a)=>{for(var t in a||(a={}))n.call(a,t)&&l(e,t,a[t]);if(r)for(var t of r(a))s.call(a,t)&&l(e,t,a[t]);return e})({},v.value),a(e,t({count:1})))):g.value[u].count=g.value[u].count+1,g.value=g.value.sort(((e,a)=>e.count-a.count)),k.set("moni/rank/mua",g.value.map((({uid:e,username:a,face:t,count:r,is_alive:n})=>({uid:e,username:a,face:t,count:r,is_alive:n})))),b=setInterval((()=>{v.value=d()}),10)}},rankList:g}}});const j={class:"moni"},M={class:"guard-container"},R={class:"flex"},G={class:"guard-title flex-1"},x={class:"guard-list no-scrollbar"},$={key:0},N={class:"flex-1"},U=m("h3",{class:"title"},"朝海沫霓Moni Mua~",-1),I={key:0,class:"container flex"},P=m("h3",{class:"rank-title"},"刀了榜",-1),S={class:"rank-list no-scrollbar"},C={class:"flex"},D={class:"flex-1"};O.render=function(e,a,t,r,n,s){return y(),d("div",j,[m("div",M,[m("div",R,[m("h3",G," 舰长总数： "+p(e.guardNum),1),m("button",{class:"btn-reload",onClick:a[1]||(a[1]=(...a)=>e.onRefresh&&e.onRefresh(...a))},"刷新")]),m("ul",x,[e.loading?(y(),d("li",$," 获取舰长数据中... ")):v("",!0),(y(!0),d(f,null,g(e.guardList,(e=>(y(),d("li",{key:e.uid,class:["guard-item",e.is_alive?"alive":""]},[m("img",{class:"guard-face",src:e.face+"@128w_128h",alt:""},null,8,["src"]),m("p",null,[m("span",null,p(e.is_alive?"[在线]":""),1),b(" "+p(e.username),1)])],2)))),128))])]),m("div",N,[U,e.currentGuard&&e.currentGuard.uid?(y(),d("div",I,[e.currentGuard.face?(y(),d("img",{key:0,class:"guard-face",src:e.currentGuard.face+"@128w_128h",alt:""},null,8,["src"])):v("",!0),m("p",null,[m("span",null,p(e.currentGuard.is_alive?"[在线]":"[不在]"),1),b(" "+p(e.currentGuard.username),1)])])):v("",!0),m("div",null,[m("button",{class:"btn-mua",onClick:a[2]||(a[2]=(...a)=>e.onMua&&e.onMua(...a))},"Mua~")]),P,m("ul",S,[(y(!0),d(f,null,g(e.rankList,(e=>(y(),d("li",{key:e.uid,class:"flex"},[m("img",{class:"guard-face",src:e.face+"@128w_128h",alt:""},null,8,["src"]),m("p",C,[m("span",D,p(e.username),1),m("span",null,p(e.count)+" 次",1)])])))),128))])])])},h(O).mount("#app");
